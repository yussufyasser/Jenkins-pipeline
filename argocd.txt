kubectl create namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml


#!/bin/bash


APP_NAME="jenkins-pipeline-app"
GIT_REPO="https://github.com/yussufyasser/Jenkins-pipeline.git"
GIT_PATH="Kubernetes"
DEST_NAMESPACE="default"
ARGO_NAMESPACE="argocd"


kubectl wait --for=condition=Ready pods --all -n argocd --timeout=300s || {
  echo "Argo CD pods did not become ready in time."
  exit 1
}

ARGOCD_PASSWORD=$(kubectl -n $ARGO_NAMESPACE get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d)
ARGOCD_SERVER=$(kubectl -n $ARGO_NAMESPACE get svc argocd-server -o jsonpath="{.status.loadBalancer.ingress[0].hostname}")


if [ -z "$ARGOCD_SERVER" ]; then
  echo "No LoadBalancer found, falling back to localhost via port-forward..."
  kubectl port-forward svc/argocd-server -n $ARGO_NAMESPACE 8080:443 &
  sleep 5
  ARGOCD_SERVER="localhost:8080"
fi

argocd login $ARGOCD_SERVER --username admin --password $ARGOCD_PASSWORD --insecure


argocd app create $APP_NAME \
  --repo $GIT_REPO \
  --path $GIT_PATH \
  --dest-server https://kubernetes.default.svc \
  --dest-namespace $DEST_NAMESPACE \
  --sync-policy automated


argocd app sync $APP_NAME


